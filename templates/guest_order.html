{# ────────────────────────────────────────────────────────────── #}
{% extends "base.html" %}
{% block title %}Guest Checkout{% endblock %}

{% block content %}
<div class="container py-5">
  <h2>Guest Checkout</h2>

  {% if order %}
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-light fw-bold">Order Summary</div>
    <div class="card-body">
      <p class="mb-1"><strong>Vehicle&nbsp;Size:</strong> {{ order.vehicle_size }}</p>
      <p><strong>Service Date:</strong> {{ order.service_date or "—" }}</p>
      <p><strong>Service Time:</strong>
         {{ order.service_time[:5] if order.service_time else "—" }}</p>

      <ul class="list-group mb-3">
        {% for svc in order.services %}
          <li class="list-group-item">{{ loop.index }}.&nbsp;{{ svc.label }}</li>
        {% endfor %}
      </ul>

      <div class="d-flex justify-content-between">
        <span>Travel&nbsp;Fee:</span>  <span>${{ order.travel_fee }}</span>
      </div>
      <div class="d-flex justify-content-between fs-5 fw-semibold border-top pt-2 mt-2">
        <span>Total:</span>           <span>${{ order.total }}</span>
      </div>
    </div>
  </div>
  {% endif %}

  {# ──────────────── GUEST CHECKOUT FORM ──────────────── #}
  <form method="post" novalidate>
    {{ form.csrf_token }}

    {# ── payment choice ── #}
    <div class="mb-3">
      <label class="form-label fw-bold">How would you like to pay?</label>

      <div class="form-check">
        <input  class="form-check-input" type="radio" id="pay_full_now"
                name="payment_time" value="pay_now"
                {{ "checked" if form.payment_time.data != "pay_after_completion" }}>
        <label class="form-check-label" for="pay_full_now">
          Pay <strong>in&nbsp;full&nbsp;now</strong>
          <span class="text-muted">– ${{ "%.2f"|format(order.total) }}</span>
        </label>
      </div>

      <div class="form-check">
        <input  class="form-check-input" type="radio" id="pay_deposit"
                name="payment_time" value="pay_after_completion"
                {{ "checked" if form.payment_time.data == "pay_after_completion" }}>
        <label class="form-check-label" for="pay_deposit">
          Pay <strong>deposit&nbsp;now</strong>
          <span class="text-muted">
            – ${{ "%.2f"|format(order.deposit) }}
            (balance ${{ "%.2f"|format(order.total - order.deposit) }} at completion)
          </span>
        </label>
      </div>
      {% if form.payment_time.errors %}
        <div class="text-danger small">{{ form.payment_time.errors[0] }}</div>
      {% endif %}
    </div>

    {# ── guest & address fields ── #}
    <div class="row g-3">
      <div class="col-md-6">
        {{ form.guest_name.label(class="form-label") }}
        {{ form.guest_name(class="form-control", placeholder="Full name") }}
        {% if form.guest_name.errors %}
          <div class="text-danger small">{{ form.guest_name.errors[0] }}</div>
        {% endif %}
      </div>

      <div class="col-md-6">
        {{ form.guest_email.label(class="form-label") }}
        {{ form.guest_email(class="form-control", placeholder="email@example.com") }}
        {% if form.guest_email.errors %}
          <div class="text-danger small">{{ form.guest_email.errors[0] }}</div>
        {% endif %}
      </div>

      <div class="col-12">
        {{ form.street_address.label(class="form-label") }}
        {{ form.street_address(class="form-control", placeholder="123 Main St") }}
      </div>

      <div class="col-md-6">
        {{ form.unit_apt.label(class="form-label") }}
        {{ form.unit_apt(class="form-control", placeholder="Apt / Unit (optional)") }}
      </div>

      <div class="col-md-4">
        {{ form.city.label(class="form-label") }}
        {{ form.city(class="form-control") }}
      </div>

      <div class="col-md-2">
        {{ form.zip_code.label(class="form-label") }}
        {{ form.zip_code(class="form-control") }}
      </div>

      <div class="col-12">
        {{ form.country.label(class="form-label") }}
        {{ form.country(class="form-select") }}
      </div>
    </div>

    <button type="submit" class="btn btn-primary mt-4">
      {{ form.submit.label.text }}
    </button>
  </form>
</div>
{% endblock %}
{# ────────────────────────────────────────────────────────────── #}
